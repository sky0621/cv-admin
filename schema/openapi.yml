openapi: 3.0.3

info:
  title: CV API
  description: CV API
  version: 1.0.0

servers:
  - url: 'http://localhost:{port}'
    description: "ローカル環境"
    variables:
      port:
        description: "ポート番号"
        enum: ["8080","3000"]
        default: "8080"

tags:
  - name: "users"
    description: "ユーザーに対するCRUD"

security: []

paths:
  "/users":
    post:
      summary: "ユーザーアカウント登録"
      description: "ユーザーアカウントを登録する。"
      tags: ["users"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserAttribute"
      responses:
        "201":
          $ref: "#/components/responses/201-Created-UserAttribute"
        "400":
          $ref: "#/components/responses/400-BadRequest"

  "/users/{byUserId}":
    parameters:
      - $ref: "#/components/parameters/userId"
    delete:
      summary: "指定ユーザーアカウント削除"
      description: "指定ユーザーアカウントを削除する。"
      tags: ["users"]
      responses:
        "204":
          description: "No Content: 指定ユーザーアカウントの削除に成功。"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/attribute":
    parameters:
      - $ref: "#/components/parameters/userId"
    put:
      summary: "属性更新"
      description: "指定ユーザーの属性を更新する。"
      tags: ["users"]
      requestBody:
        description: "属性"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserAttribute"
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserAttribute"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"
    get:
      summary: "属性取得"
      description: "指定ユーザーの属性を取得する。"
      tags: ["users"]
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserAttribute"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/activities":
    parameters:
      - $ref: "#/components/parameters/userId"
    put:
      summary: "アクティビティ群最新化"
      description: "指定ユーザーのアクティビティ群を最新化（総洗い替え）する。"
      tags: ["users"]
      requestBody:
        description: "アクティビティ群"
        required: true
        content:
          application/json:
            schema:
              type: array
              description: "１ユーザーのアクティビティ群"
              items:
                $ref: "#/components/schemas/UserActivity"
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserActivities"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"
    get:
      summary: "アクティビティ群取得"
      description: "指定ユーザーのアクティビティ群を取得する。"
      tags: ["users"]
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserActivities"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/qualifications":
    parameters:
      - $ref: "#/components/parameters/userId"
    put:
      summary: "資格情報群最新化"
      description: "指定ユーザーの資格情報群を最新化（総洗い替え）する。"
      tags: ["users"]
      requestBody:
        description: "資格情報群"
        required: true
        content:
          application/json:
            schema:
              type: array
              description: "１ユーザーの資格情報群"
              items:
                $ref: "#/components/schemas/UserQualification"
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserQualifications"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"
    get:
      summary: "資格情報群取得"
      description: "指定ユーザーの資格情報群を取得する。"
      tags: ["users"]
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserQualifications"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/careergroups":
    parameters:
      - $ref: "#/components/parameters/userId"
    post:
      summary: "キャリアグループ新規登録"
      description: "キャリアグループを新規登録する。"
      tags: ["users"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCareerGroup"
      responses:
        "201":
          description: "Created: キャリアグループを新規登録済み。"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"
    get:
      summary: "キャリアグループ群取得"
      description: "指定ユーザーのキャリアグループ群を取得する。"
      tags: ["users"]
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserCareerGroups"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/careergroups/{byCareerGroupId}":
    parameters:
      - $ref: "#/components/parameters/userId"
      - $ref: "#/components/parameters/careerGroupId"
    put:
      summary: "キャリアグループ更新"
      description: "１キャリアグループを更新する。"
      tags: ["users"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserCareerGroupOwn"
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserCareerGroupOwn"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"
    delete:
      summary: "キャリアグループ削除"
      description: "１キャリアグループを削除する。"
      tags: ["users"]
      responses:
        "204":
          description: "No Content: 指定キャリアグループの削除に成功。"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/careergroups/{byCareerGroupId}/careers":
    parameters:
      - $ref: "#/components/parameters/userId"
      - $ref: "#/components/parameters/careerGroupId"
    put:
      summary: "キャリアグループ内キャリア群最新化"
      description: "１キャリアグループ内のキャリア群を最新化（総洗い替え）する。"
      tags: ["users"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              description: "１ユーザーのキャリアグループのキャリア群"
              items:
                $ref: "#/components/schemas/UserCareer"
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserCareers"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/notes":
    parameters:
      - $ref: "#/components/parameters/userId"
    post:
      summary: "注釈新規登録"
      description: "注釈を新規登録する。"
      tags: ["users"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserNote"
      responses:
        "201":
          description: "Created: 注釈を新規登録済み。"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"
    get:
      summary: "注釈群取得"
      description: "指定ユーザーの注釈群を取得する。"
      tags: ["users"]
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserNotes"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/notes/{byNoteId}":
    parameters:
      - $ref: "#/components/parameters/userId"
      - $ref: "#/components/parameters/noteId"
    put:
      summary: "注釈更新"
      description: "１注釈を更新する。"
      tags: ["users"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserNoteOwn"
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserNoteOwn"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"
    delete:
      summary: "注釈削除"
      description: "１注釈を削除する。"
      tags: ["users"]
      responses:
        "204":
          description: "No Content: 指定注釈の削除に成功。"
        "404":
          $ref: "#/components/responses/404-NotFound"

  "/users/{byUserId}/notes/{byNoteId}/items":
    parameters:
      - $ref: "#/components/parameters/userId"
      - $ref: "#/components/parameters/noteId"
    put:
      summary: "注釈内要素群最新化"
      description: "１注釈内の要素群を最新化（総洗い替え）する。"
      tags: ["users"]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserNoteItems"
      responses:
        "200":
          $ref: "#/components/responses/200-OK-UserNoteItems"
        "400":
          $ref: "#/components/responses/400-BadRequest"
        "404":
          $ref: "#/components/responses/404-NotFound"

components:
  schemas:
    UserId:
      type: integer
      format: int
      description: "ユーザーを一意に識別するキー"
      example: 1
    UserName:
      type: string
      description: "ユーザーの本名"
      example: "山田太郎"
    UserNickName:
      type: string
      description: "ユーザーのニックネーム"
      example: "ドカベン"
    Url:
      type: string
      format: uri
      description: "URL"
      example: "https:/example.com/205e460b479e2e2248aec07710c08d50"
    Year:
      type: integer
      format: int
      description: "生年月日の「年」"
      example: 2022
    Month:
      type: integer
      format: int
      description: "生年月日の「月」"
      example: 9
    Day:
      type: integer
      format: int
      description: "生年月日の「日」"
      example: 10
    BirthDay:
      type: object
      description: "生年月日"
      example: "{year: 2022, month: 9, day:10}"
      properties:
        year:
          $ref: "#/components/schemas/Year"
        month:
          $ref: "#/components/schemas/Month"
        day:
          $ref: "#/components/schemas/Day"
    Job:
      type: string
      description: "職業"
      example: "エンジニア"
    BelongTo:
      type: string
      description: "所属"
      example: "フリー"
    PR:
      type: string
      description: "PR"
      example: "私は20年以上のキャリアを持ち、〜〜"
    ActivityName:
      type: string
      description: "アクティビティ名"
      example: "GitHub"
    ActivityIcon:
      type: string
      description: "アクティビティアイコン"
      example: "github"
    QualificationName:
      type: string
      description: "資格名"
      example: "Oracle Master"
    QualificationOrg:
      type: string
      description: "組織名"
      example: "Oracle"
    QualificationGotDate:
      type: string
      format: date
      description: "取得日"
      example: "2022-09-10"
    QualificationMemo:
      type: string
      description: "メモ"
      example: "期限切れ"
    CareerName:
      type: string
      description: "キャリア名"
      example: "物流システム開発"
    CareerPeriodFrom:
      type: object
      description: "キャリア期間年月From"
      example: "{year: 2021, month: 9}"
      properties:
        year:
          $ref: "#/components/schemas/Year"
        month:
          $ref: "#/components/schemas/Month"
    CareerPeriodTo:
      type: object
      description: "キャリア期間年月To"
      example: "{year: 2022, month: 10}"
      properties:
        year:
          $ref: "#/components/schemas/Year"
        month:
          $ref: "#/components/schemas/Month"
    CareerGroupLabel:
      type: string
      description: "キャリアグループラベル"
      example: "某コンサルティング会社にて就労"
    TaskName:
      type: string
      description: "タスク名"
      example: "バックエンドの機能拡張、不具合改修。"
    TaskDescriptions:
      type: array
      description: "タスク説明"
      example: "['・分析APIのベース開発', '・各種バッチ開発']"
      items:
        type: string
        description: "タスク説明１文"
        example: "・分析APIのベース開発"
    SkillName:
      type: string
      description: "スキル名"
      example: "Golang"
    SkillVersion:
      type: string
      description: "スキルバージョン"
      example: "v1.19"
    SkillGroupLabel:
      type: string
      description: "スキルグループラベル"
      example: "Backend"
    NoteId:
      type: integer
      format: int
      description: "注釈を一意に識別するID"
      example: 1
    NoteItemText:
      type: string
      description: "注釈内の１要素"
      example: "GraphQLを使っている"
    NoteLabel:
      type: string
      description: "ラベル"
      example: "就労条件"
    NoteMemo:
      type: string
      description: "メモ"
      example: "以下、順不同。"
    UserAttribute:
      type: object
      description: "１ユーザーの属性"
      properties:
        id:
          $ref: "#/components/schemas/UserId"
        name:
          $ref: "#/components/schemas/UserName"
        nickname:
          $ref: "#/components/schemas/UserNickName"
        avatarUrl:
          $ref: "#/components/schemas/Url"
        birthday:
          $ref: "#/components/schemas/BirthDay"
        job:
          $ref: "#/components/schemas/Job"
        belongTo:
          $ref: "#/components/schemas/BelongTo"
        pr:
          $ref: "#/components/schemas/PR"
    UserActivity:
      type: object
      description: "１ユーザーのアクティビティ"
      properties:
        name:
          $ref: "#/components/schemas/ActivityName"
        url:
          $ref: "#/components/schemas/Url"
        icon:
          $ref: "#/components/schemas/ActivityIcon"
    UserQualification:
      type: object
      description: "１ユーザーの資格情報"
      properties:
        name:
          $ref: "#/components/schemas/QualificationName"
        organization:
          $ref: "#/components/schemas/QualificationOrg"
        url:
          $ref: "#/components/schemas/Url"
        gotDate:
          $ref: "#/components/schemas/QualificationGotDate"
        memo:
          $ref: "#/components/schemas/QualificationMemo"
    CareerTask:
      type: object
      description: "１キャリアのタスク"
      properties:
        name:
          $ref: "#/components/schemas/TaskName"
        description:
          $ref: "#/components/schemas/TaskDescriptions"
    CareerTasks:
      type: array
      description: "１キャリアのタスク群"
      items:
        $ref: "#/components/schemas/CareerTask"
    CareerSkill:
      type: object
      description: "１キャリアのスキル"
      properties:
        name:
          $ref: "#/components/schemas/SkillName"
        url:
          $ref: "#/components/schemas/Url"
        version:
          $ref: "#/components/schemas/SkillVersion"
    CareerSkills:
      type: array
      description: "１キャリアのスキル群"
      items:
        $ref: "#/components/schemas/CareerSkill"
    CareerGroupId:
      type: integer
      format: int
      description: "キャリアグループを一意に識別するID"
      example: 1
    CareerSkillGroup:
      type: object
      properties:
        label:
          $ref: "#/components/schemas/SkillGroupLabel"
        skills:
          $ref: "#/components/schemas/CareerSkills"
    UserCareer:
      type: object
      description: "１キャリアグループのキャリア"
      properties:
        name:
          $ref: "#/components/schemas/CareerName"
        description:
          type: array
          description: "キャリア説明"
          example: "['物流システムを新規開発する。']"
          items:
            type: string
            description: "キャリア説明１文"
            example: "物流システムを新規開発する。"
        from:
          $ref: "#/components/schemas/CareerPeriodFrom"
        to:
          $ref: "#/components/schemas/CareerPeriodTo"
        tasks:
          $ref: "#/components/schemas/CareerTasks"
        skillGroups:
          type: array
          description: "１キャリアのスキルグループ群"
          items:
            $ref: "#/components/schemas/CareerSkillGroup"
    UserCareerGroup:
      type: object
      description: "１ユーザーのキャリアグループ"
      properties:
        label:
          $ref: "#/components/schemas/CareerGroupLabel"
        careers:
          type: array
          description: "１ユーザーのキャリアグループのキャリア群"
          items:
            $ref: "#/components/schemas/UserCareer"
    UserCareerGroups:
      type: array
      description: "１ユーザーのキャリアグループ群"
      items:
        $ref: "#/components/schemas/UserCareerGroup"
    UserCareerGroupOwn:
      type: object
      description: "１ユーザーのキャリアグループ自身"
      properties:
        label:
          $ref: "#/components/schemas/CareerGroupLabel"
    UserNoteItem:
      type: object
      description: "１ユーザーの注釈内の１要素"
      properties:
        text:
          $ref: "#/components/schemas/NoteItemText"
    UserNoteItems:
      type: array
      description: "１ユーザーの注釈内の要素群"
      items:
        $ref: "#/components/schemas/UserNoteItem"
    UserNoteOwn:
      type: object
      description: "１ユーザーの注釈自身"
      properties:
        label:
          $ref: "#/components/schemas/NoteLabel"
        memo:
          $ref: "#/components/schemas/NoteMemo"
    UserNote:
      type: object
      description: "１ユーザーの注釈"
      properties:
        label:
          $ref: "#/components/schemas/NoteLabel"
        memo:
          $ref: "#/components/schemas/NoteMemo"
        items:
          $ref: "#/components/schemas/UserNoteItems"
    UserNotes:
      type: array
      description: "１ユーザーの注釈群"
      items:
        $ref: "#/components/schemas/UserNote"
    ErrorMessage:
      type: string
      description: "エラーメッセージ"
      example: "xxxx"
      minLength: 1
      maxLength: 80
    ClientError:
      type: object
      properties:
        message:
          $ref: "#/components/schemas/ErrorMessage"
    NotFoundError:
      type: object
      properties:
        message:
          $ref: "#/components/schemas/ErrorMessage"

  parameters:
    userId:
      name: "byUserId"
      in: "path"
      required: true
      schema:
        $ref: "#/components/schemas/UserId"
    noteId:
      name: "byNoteId"
      in: "path"
      required: true
      schema:
        $ref: "#/components/schemas/NoteId"
    careerGroupId:
      name: "byCareerGroupId"
      in: "path"
      required: true
      schema:
        $ref: "#/components/schemas/CareerGroupId"

  responses:
    201-Created-UserAttribute:
      description: "Created: 指定ユーザーの属性を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserAttribute"
    200-OK-UserAttribute:
      description: "OK: 指定ユーザーの属性を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserAttribute"
    200-OK-UserActivities:
      description: "OK: 指定ユーザーのアクティビティ群を返却する。"
      content:
        application/json:
          schema:
            type: array
            description: "１ユーザーのアクティビティ群"
            items:
              $ref: "#/components/schemas/UserActivity"
    200-OK-UserQualifications:
      description: "OK: 指定ユーザーの資格情報群を返却する。"
      content:
        application/json:
          schema:
            type: array
            description: "１ユーザーの資格情報群"
            items:
              $ref: "#/components/schemas/UserQualification"
    200-OK-UserCareers:
      description: "OK: 指定ユーザーの１キャリアグループ内のキャリア群を返却する。"
      content:
        application/json:
          schema:
            type: array
            description: "１ユーザーのキャリアグループのキャリア群"
            items:
              $ref: "#/components/schemas/UserCareer"
    200-OK-UserCareerGroups:
      description: "OK: 指定ユーザーのキャリアグループ群を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserCareerGroups"
    200-OK-UserCareerGroupOwn:
      description: "OK: 指定ユーザーのキャリアグループ自身を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserCareerGroupOwn"
    200-OK-UserNoteItems:
      description: "OK: 指定ユーザーの１注釈内の要素群を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserNoteItems"
    200-OK-UserNoteOwn:
      description: "OK: 指定ユーザーの注釈自身を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserNoteOwn"
    200-OK-UserNote:
      description: "OK: 指定ユーザーの注釈を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserNote"
    200-OK-UserNotes:
      description: "OK: 指定ユーザーの注釈群を返却する。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/UserNotes"
    400-BadRequest:
      description: "Bad Request: 属性に誤りがある。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/ClientError"
    404-NotFound:
      description: "Not Found: 指定リソースが存在しない。"
      content:
        application/json:
          schema:
            $ref: "#/components/schemas/NotFoundError"